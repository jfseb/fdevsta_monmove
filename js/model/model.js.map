{"version":3,"sources":["/projects/nodejs/botbuilder/fdevstar_monmove/src/model/model.ts"],"names":[],"mappings":"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","file":"model/model.js","sourcesContent":["/**\r\n * Functionality managing the match models\r\n *\r\n * @file\r\n */\r\n\r\n//import * as intf from 'constants';\r\nimport * as debug from 'debug';\r\n\r\nvar debuglog = debug('model');\r\n\r\n//const loadlog = logger.logger('modelload', '');\r\n\r\nimport *  as IMatch from '../match/ifmatch';\r\nimport * as InputFilterRules from '../match/rule';\r\n//import * as Tools from '../match/tools';\r\nimport * as fs from 'fs';\r\nimport * as Meta from './meta';\r\nimport * as Utils from 'abot_utils';\r\nimport * as CircularSer from 'abot_utils';\r\nimport * as Distance from 'abot_stringdist';\r\nimport * as process from 'process';\r\nimport * as _ from 'lodash';\r\n/**\r\n * the model path, may be controlled via environment variable\r\n */\r\nvar envModelPath = process.env[\"ABOT_MODELPATH\"] || \"testmodel\";\r\n\r\n\r\nexport function cmpTools(a: IMatch.ITool, b: IMatch.ITool) {\r\n  return a.name.localeCompare(b.name);\r\n}\r\n\r\n\r\n//export interface IModels = Match.IModels;\r\n\r\n/*\r\nexport interface IModels {\r\n    domains: string[],\r\n    tools: IMatch.ITool[],\r\n    category: string[],\r\n    mRules: IMatch.mRule[],\r\n    records: any[]\r\n    seenRules?: { [key: string]: IMatch.mRule },\r\n    meta : {\r\n        // entity -> relation -> target\r\n        t3 : { [key: string] : { [key : string] : any }}\r\n    }\r\n}*/\r\n\r\ntype IModel = IMatch.IModel;\r\n\r\nconst ARR_MODEL_PROPERTIES = [\"domain\", \"bitindex\", \"defaultkeycolumn\", \"defaulturi\", \"categoryDescribed\", \"columns\", \"description\", \"tool\", \"toolhidden\", \"synonyms\", \"category\", \"wordindex\", \"exactmatch\", \"hidden\"];\r\n\r\nfunction addSynonyms(synonyms: string[], category: string, synonymFor: string, bitindex: number, mRules: Array<IMatch.mRule>, seen: { [key: string]: IMatch.mRule[] }) {\r\n    synonyms.forEach(function (syn) {\r\n        var oRule = {\r\n            category: category,\r\n            matchedString: synonymFor,\r\n            type: IMatch.EnumRuleType.WORD,\r\n            word: syn,\r\n            bitindex: bitindex,\r\n            _ranking: 0.95\r\n        };\r\n        debuglog(debuglog.enabled ? (\"inserting synonym\" + JSON.stringify(oRule)) : '-');\r\n        insertRuleIfNotPresent(mRules, oRule, seen);\r\n    });\r\n}\r\n\r\nfunction getRuleKey(rule) {\r\n    var r1 = rule.matchedString + \"-|-\" + rule.category + \" -|- \" + rule.type + \" -|- \" + rule.word + \" \";\r\n    if (rule.range) {\r\n        var r2 = getRuleKey(rule.range.rule);\r\n        r1 += \" -|- \" + rule.range.low + \"/\" + rule.range.high + \" -|- \" + r2;\r\n    }\r\n    return r1;\r\n}\r\n\r\n\r\nimport * as Breakdown from '../match/breakdown';\r\n\r\n/* given a rule which represents a word sequence which is split during tokenization */\r\nexport function addBestSplit(mRules: Array<IMatch.mRule>, rule: IMatch.mRule, seenRules: { [key: string]: IMatch.mRule[] }) {\r\n    //if(!global_AddSplits) {\r\n    //    return;\r\n    //}\r\n\r\n    if (rule.type !== IMatch.EnumRuleType.WORD) {\r\n        return;\r\n    }\r\n    var best = Breakdown.makeMatchPattern(rule.lowercaseword);\r\n    if (!best) {\r\n        return;\r\n    }\r\n    var newRule = {\r\n        category: rule.category,\r\n        matchedString: rule.matchedString,\r\n        bitindex: rule.bitindex,\r\n        word: best.longestToken,\r\n        type: 0,\r\n        lowercaseword: best.longestToken,\r\n        _ranking: 0.95,\r\n        //    exactOnly : rule.exactOnly,\r\n        range: best.span\r\n    } as IMatch.mRule;\r\n    if (rule.exactOnly) {\r\n        newRule.exactOnly = rule.exactOnly\r\n    };\r\n    newRule.range.rule = rule;\r\n    insertRuleIfNotPresent(mRules, newRule, seenRules);\r\n}\r\n\r\n\r\nfunction insertRuleIfNotPresent(mRules: Array<IMatch.mRule>, rule: IMatch.mRule,\r\n    seenRules: { [key: string]: IMatch.mRule[] }) {\r\n\r\n    if (rule.type !== IMatch.EnumRuleType.WORD) {\r\n        mRules.push(rule);\r\n        return;\r\n    }\r\n    if ((rule.word === undefined) || (rule.matchedString === undefined)) {\r\n        throw new Error('illegal rule' + JSON.stringify(rule, undefined, 2));\r\n    }\r\n    var r = getRuleKey(rule);\r\n    /* if( (rule.word === \"service\" || rule.word=== \"services\") && r.indexOf('OData') >= 0) {\r\n         console.log(\"rulekey is\" + r);\r\n         console.log(\"presence is \" + JSON.stringify(seenRules[r]));\r\n     }*/\r\n    rule.lowercaseword = rule.word.toLowerCase();\r\n    if (seenRules[r]) {\r\n        debuglog(debuglog.enabled ? (\"Attempting to insert duplicate\" + JSON.stringify(rule, undefined, 2)) : \"-\");\r\n        var duplicates = seenRules[r].filter(function (oEntry) {\r\n            return 0 === InputFilterRules.compareMRuleFull(oEntry, rule);\r\n        });\r\n        if (duplicates.length > 0) {\r\n            return;\r\n        }\r\n    }\r\n    seenRules[r] = (seenRules[r] || []);\r\n    seenRules[r].push(rule);\r\n    if (rule.word === \"\") {\r\n        debuglog(debuglog.enabled ? ('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2)) : '-');\r\n        //g('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2));\r\n        return;\r\n    }\r\n    mRules.push(rule);\r\n    addBestSplit(mRules, rule, seenRules);\r\n    return;\r\n}\r\n\r\nfunction readFileAsJSON(filename : string) : any {\r\n    var data = fs.readFileSync(filename, 'utf-8');\r\n    try {\r\n        return JSON.parse(data);\r\n    } catch(e) {\r\n        console.log(\"Content of file \"+ filename + \" is no json\" + e);\r\n        process.exit(-1);\r\n    }\r\n    return undefined;\r\n}\r\n\r\nfunction loadModelData(modelPath: string, oMdl: IModel, sModelName: string, oModel: IMatch.IModels) {\r\n    // read the data ->\r\n    // data is processed into mRules directly,\r\n    var bitindex = oMdl.bitindex;\r\n    const sFileName = ('./' + modelPath + '/' + sModelName + \".data.json\");\r\n    var oMdlData= readFileAsJSON(sFileName);\r\n    oMdlData.forEach(function (oEntry) {\r\n        if (!oEntry.domain) {\r\n            oEntry._domain = oMdl.domain;\r\n        }\r\n        if (!oEntry.tool && oMdl.tool.name) {\r\n            oEntry.tool = oMdl.tool.name;\r\n        }\r\n        oModel.records.push(oEntry);\r\n        oMdl.category.forEach(function (cat) {\r\n            if (oEntry[cat] === 'undefined') {\r\n                oEntry[cat] = \"n/a\";\r\n                var bug =\r\n                    \"INCONSISTENT*> ModelData \" + sFileName + \" does not contain category \" + cat + \" with value 'undefined', undefined is illegal value, use n/a \" + JSON.stringify(oEntry) + \"\";\r\n                debuglog(bug);\r\n                //console.log(bug);\r\n                //process.exit(-1);\r\n            }\r\n        })\r\n\r\n        oMdl.wordindex.forEach(function (category) {\r\n            if (oEntry[category] === undefined) {\r\n                debuglog(\"INCONSISTENT*> ModelData \" + sFileName + \" does not contain category \" + category + \" of wordindex\" + JSON.stringify(oEntry) + \"\")\r\n                return;\r\n            }\r\n            if (oEntry[category] !== \"*\") {\r\n                var sString = oEntry[category];\r\n                debuglog(\"pushing rule with \" + category + \" -> \" + sString);\r\n                var oRule = {\r\n                    category: category,\r\n                    matchedString: sString,\r\n                    type: IMatch.EnumRuleType.WORD,\r\n                    word: sString,\r\n                    bitindex: bitindex,\r\n                    _ranking: 0.95\r\n                } as IMatch.mRule;\r\n                if (oMdl.exactmatch && oMdl.exactmatch.indexOf(category) >= 0) {\r\n                    oRule.exactOnly = true;\r\n                }\r\n                insertRuleIfNotPresent(oModel.mRules, oRule, oModel.seenRules);\r\n                if (oMdlData.synonyms && oMdlData.synonyms[category]) {\r\n                    addSynonyms(oMdlData.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);\r\n                }\r\n                if (oEntry.synonyms && oEntry.synonyms[category]) {\r\n                    addSynonyms(oEntry.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n\r\n\r\n\r\nfunction loadModel(modelPath: string, sModelName: string, oModel: IMatch.IModels) {\r\n    debuglog(\" loading \" + sModelName + \" ....\");\r\n    var oMdl = readFileAsJSON('./' + modelPath + '/' + sModelName + \".model.json\") as IModel;\r\n    mergeModelJson(sModelName, oMdl, oModel);\r\n    loadModelData(modelPath, oMdl, sModelName, oModel);\r\n}\r\n\r\nexport function getDomainBitIndex(domain: string, oModel: IMatch.IModels): number {\r\n    var index = oModel.domains.indexOf(domain);\r\n    if (index < 0) {\r\n        index = oModel.domains.length;\r\n    }\r\n    if (index >= 32) {\r\n        throw new Error(\"too many domain for single 32 bit index\");\r\n    }\r\n    return 0x0001 << index;\r\n}\r\n\r\nfunction mergeModelJson(sModelName: string, oMdl: IModel, oModel: IMatch.IModels) {\r\n    var categoryDescribedMap = {} as { [key: string]: IMatch.ICategoryDesc };\r\n    oMdl.bitindex = getDomainBitIndex(oMdl.domain, oModel);\r\n    oMdl.categoryDescribed = [];\r\n    // rectify category\r\n    oMdl.category = oMdl.category.map(function (cat: any) {\r\n        if (typeof cat === \"string\") {\r\n            return cat;\r\n        }\r\n        if (typeof cat.name !== \"string\") {\r\n            console.log(\"Missing name in object typed category in \" + JSON.stringify(cat) + \" in model \" + sModelName);\r\n            process.exit(-1);\r\n            //throw new Error('Domain ' + oMdl.domain + ' already loaded while loading ' + sModelName + '?');\r\n        }\r\n        categoryDescribedMap[cat.name] = cat;\r\n        oMdl.categoryDescribed.push(cat);\r\n        return cat.name;\r\n    });\r\n\r\n    // add the categories to the model:\r\n    oMdl.category.forEach(function (category) {\r\n        insertRuleIfNotPresent(oModel.mRules, {\r\n            category: \"category\",\r\n            matchedString: category,\r\n            type: IMatch.EnumRuleType.WORD,\r\n            word: category,\r\n            lowercaseword: category.toLowerCase(),\r\n            bitindex: oMdl.bitindex,\r\n            _ranking: 0.95\r\n        }, oModel.seenRules);\r\n    });\r\n\r\n    if (oModel.domains.indexOf(oMdl.domain) >= 0) {\r\n        debuglog(\"***********here mdl\" + JSON.stringify(oMdl, undefined, 2));\r\n        throw new Error('Domain ' + oMdl.domain + ' already loaded while loading ' + sModelName + '?');\r\n    }\r\n    // check properties of model\r\n    Object.keys(oMdl).sort().forEach(function (sProperty) {\r\n        if (ARR_MODEL_PROPERTIES.indexOf(sProperty) < 0) {\r\n            throw new Error('Model property \"' + sProperty + '\" not a known model property in model of domain ' + oMdl.domain + ' ');\r\n        }\r\n    });\r\n    // consider streamlining the categories\r\n    oModel.rawModels[oMdl.domain] = oMdl;\r\n\r\n    oModel.full.domain[oMdl.domain] = {\r\n        description: oMdl.description,\r\n        categories: categoryDescribedMap,\r\n        bitindex: oMdl.bitindex\r\n    };\r\n\r\n    // check that\r\n\r\n\r\n    // check that members of wordindex are in categories,\r\n    oMdl.wordindex = oMdl.wordindex || [];\r\n    oMdl.wordindex.forEach(function (sWordIndex) {\r\n        if (oMdl.category.indexOf(sWordIndex) < 0) {\r\n            throw new Error('Model wordindex \"' + sWordIndex + '\" not a category of domain ' + oMdl.domain + ' ');\r\n        }\r\n    });\r\n    oMdl.exactmatch = oMdl.exactmatch || [];\r\n    oMdl.exactmatch.forEach(function (sExactMatch) {\r\n        if (oMdl.category.indexOf(sExactMatch) < 0) {\r\n            throw new Error('Model exactmatch \"' + sExactMatch + '\" not a category of domain ' + oMdl.domain + ' ');\r\n        }\r\n    });\r\n    oMdl.columns = oMdl.columns || [];\r\n    oMdl.columns.forEach(function (sExactMatch) {\r\n        if (oMdl.category.indexOf(sExactMatch) < 0) {\r\n            throw new Error('Model column \"' + sExactMatch + '\" not a category of domain ' + oMdl.domain + ' ');\r\n        }\r\n    });\r\n\r\n\r\n    // add relation domain -> category\r\n    var domainStr = MetaF.Domain(oMdl.domain).toFullString();\r\n    var relationStr = MetaF.Relation(Meta.RELATION_hasCategory).toFullString();\r\n    var reverseRelationStr = MetaF.Relation(Meta.RELATION_isCategoryOf).toFullString();\r\n    oMdl.category.forEach(function (sCategory) {\r\n\r\n        var CategoryString = MetaF.Category(sCategory).toFullString();\r\n        oModel.meta.t3[domainStr] = oModel.meta.t3[domainStr] || {};\r\n        oModel.meta.t3[domainStr][relationStr] = oModel.meta.t3[domainStr][relationStr] || {};\r\n        oModel.meta.t3[domainStr][relationStr][CategoryString] = {};\r\n\r\n        oModel.meta.t3[CategoryString] = oModel.meta.t3[CategoryString] || {};\r\n        oModel.meta.t3[CategoryString][reverseRelationStr] = oModel.meta.t3[CategoryString][reverseRelationStr] || {};\r\n        oModel.meta.t3[CategoryString][reverseRelationStr][domainStr] = {};\r\n\r\n    });\r\n\r\n    // add a precice domain matchrule\r\n    insertRuleIfNotPresent(oModel.mRules, {\r\n        category: \"domain\",\r\n        matchedString: oMdl.domain,\r\n        type: IMatch.EnumRuleType.WORD,\r\n        word: oMdl.domain,\r\n        bitindex: oMdl.bitindex,\r\n        _ranking: 0.95\r\n    }, oModel.seenRules);\r\n\r\n    // check the tool\r\n    if (oMdl.tool && oMdl.tool.requires) {\r\n        var requires = Object.keys(oMdl.tool.requires || {});\r\n        var diff = _.difference(requires, oMdl.category);\r\n        if (diff.length > 0) {\r\n            console.log(` ${oMdl.domain} : Unkown category in requires of tool: \"` + diff.join('\"') + '\"');\r\n            process.exit(-1);\r\n        }\r\n        var optional = Object.keys(oMdl.tool.optional);\r\n        diff = _.difference(optional, oMdl.category);\r\n        if (diff.length > 0) {\r\n            console.log(` ${oMdl.domain} : Unkown category optional of tool: \"` + diff.join('\"') + '\"');\r\n            process.exit(-1);\r\n        }\r\n        Object.keys(oMdl.tool.sets || {}).forEach(function (setID) {\r\n            var diff = _.difference(oMdl.tool.sets[setID].set, oMdl.category);\r\n            if (diff.length > 0) {\r\n                console.log(` ${oMdl.domain} : Unkown category in setId ${setID} of tool: \"` + diff.join('\"') + '\"');\r\n                process.exit(-1);\r\n            }\r\n        });\r\n\r\n        // extract tools an add to tools:\r\n        oModel.tools.filter(function (oEntry) {\r\n            if (oEntry.name === (oMdl.tool && oMdl.tool.name)) {\r\n                console.log(\"Tool \" + oMdl.tool.name + \" already present when loading \" + sModelName);\r\n                //throw new Error('Domain already loaded?');\r\n                process.exit(-1);\r\n            }\r\n        });\r\n    } else {\r\n        oMdl.toolhidden = true;\r\n        oMdl.tool.requires = { \"impossible\": {} };\r\n    }\r\n    // add the tool name as rule unless hidden\r\n    if (!oMdl.toolhidden && oMdl.tool && oMdl.tool.name) {\r\n        insertRuleIfNotPresent(oModel.mRules, {\r\n            category: \"tool\",\r\n            matchedString: oMdl.tool.name,\r\n            type: IMatch.EnumRuleType.WORD,\r\n            word: oMdl.tool.name,\r\n            bitindex: oMdl.bitindex,\r\n            _ranking: 0.95\r\n        }, oModel.seenRules);\r\n    };\r\n    if (oMdl.synonyms && oMdl.synonyms[\"tool\"]) {\r\n        addSynonyms(oMdl.synonyms[\"tool\"], \"tool\", oMdl.tool.name, oMdl.bitindex, oModel.mRules, oModel.seenRules);\r\n    };\r\n    if (oMdl.synonyms) {\r\n        Object.keys(oMdl.synonyms).forEach(function (ssynkey) {\r\n            if (oMdl.category.indexOf(ssynkey) >= 0 && ssynkey !== \"tool\") {\r\n                if (oModel.full.domain[oMdl.domain].categories[ssynkey]) {\r\n                    oModel.full.domain[oMdl.domain].categories[ssynkey].synonyms = oMdl.synonyms[ssynkey];\r\n                }\r\n\r\n                addSynonyms(oMdl.synonyms[ssynkey], \"category\", ssynkey, oMdl.bitindex, oModel.mRules, oModel.seenRules);\r\n            }\r\n        });\r\n    }\r\n    oModel.domains.push(oMdl.domain);\r\n    if (oMdl.tool.name) {\r\n        oModel.tools.push(oMdl.tool);\r\n    }\r\n    oModel.category = oModel.category.concat(oMdl.category);\r\n    oModel.category.sort();\r\n    oModel.category = oModel.category.filter(function (string, index) {\r\n        return oModel.category[index] !== oModel.category[index + 1];\r\n    });\r\n\r\n} // loadmodel\r\n\r\nexport function splitRules(rules: IMatch.mRule[]): IMatch.SplitRules {\r\n    var res = {};\r\n    var nonWordRules = [];\r\n    rules.forEach(function (rule) {\r\n        if (rule.type === IMatch.EnumRuleType.WORD) {\r\n            if (!rule.lowercaseword) {\r\n                throw new Error(\"Rule has no member lowercaseword\" + JSON.stringify(rule));\r\n            }\r\n            res[rule.lowercaseword] = res[rule.lowercaseword] || { bitindex: 0, rules: [] };\r\n            res[rule.lowercaseword].bitindex = res[rule.lowercaseword].bitindex | rule.bitindex;\r\n            res[rule.lowercaseword].rules.push(rule);\r\n        } else {\r\n            nonWordRules.push(rule);\r\n        }\r\n    });\r\n    return {\r\n        wordMap: res,\r\n        nonWordRules: nonWordRules,\r\n        allRules: rules,\r\n        wordCache : {}\r\n    };\r\n}\r\n\r\nfunction cmpLengthSort(a: string, b: string) {\r\n    var d = a.length - b.length;\r\n    if (d) {\r\n        return d;\r\n    }\r\n    return a.localeCompare(b);\r\n}\r\n\r\n\r\nimport * as Algol from '../match/algol';\r\n// offset[0] : len-2\r\n//             len -1\r\n//             len\r\n//             len +1\r\n//             len +2\r\n//             len +3\r\n\r\nexport function findNextLen(targetLen: number, arr: string[], offsets: number[]) {\r\n    offsets.shift();\r\n    for (var i = offsets[4]; (i < arr.length) && (arr[i].length <= targetLen); ++i) {\r\n        /* empty*/\r\n    }\r\n    //console.log(\"pushing \" + i);\r\n    offsets.push(i);\r\n}\r\n\r\nexport function addRangeRulesUnlessPresent(rules: IMatch.mRule[], lcword: string, rangeRules: IMatch.mRule[], presentRulesForKey: IMatch.mRule[], seenRules) {\r\n    rangeRules.forEach(rangeRule => {\r\n        var newRule = Object.assign({}, rangeRule);\r\n        newRule.lowercaseword = lcword;\r\n        newRule.word = lcword;\r\n        //if((lcword === 'services' || lcword === 'service') && newRule.range.rule.lowercaseword.indexOf('odata')>=0) {\r\n        //    console.log(\"adding \"+ JSON.stringify(newRule) + \"\\n\");\r\n        //}\r\n        //todo: check whether an equivalent rule is already present?\r\n        var cnt = rules.length;\r\n        insertRuleIfNotPresent(rules, newRule, seenRules);\r\n    })\r\n}\r\n\r\n\r\nexport function addCloseExactRangeRules(rules: IMatch.mRule[], seenRules) {\r\n    var keysMap = {} as { [key: string]: IMatch.mRule[] };\r\n    var rangeKeysMap = {} as { [key: string]: IMatch.mRule[] };\r\n    rules.forEach(rule => {\r\n        if (rule.type === IMatch.EnumRuleType.WORD) {\r\n            //keysMap[rule.lowercaseword] = 1;\r\n            keysMap[rule.lowercaseword] = keysMap[rule.lowercaseword] || [];\r\n            keysMap[rule.lowercaseword].push(rule);\r\n            if (!rule.exactOnly && rule.range) {\r\n                rangeKeysMap[rule.lowercaseword] = rangeKeysMap[rule.lowercaseword] || [];\r\n                rangeKeysMap[rule.lowercaseword].push(rule);\r\n            }\r\n        }\r\n    });\r\n    var keys = Object.keys(keysMap);\r\n    keys.sort(cmpLengthSort);\r\n    var len = 0;\r\n    keys.forEach((key, index) => {\r\n        if (key.length != len) {\r\n            //console.log(\"shift to len\" + key.length + ' at ' + index + ' ' + key );\r\n        }\r\n        len = key.length;\r\n    });\r\n    //   keys = keys.slice(0,2000);\r\n    var rangeKeys = Object.keys(rangeKeysMap);\r\n    rangeKeys.sort(cmpLengthSort);\r\n    //console.log(` ${keys.length} keys and ${rangeKeys.length} rangekeys `);\r\n    var low = 0;\r\n    var high = 0;\r\n    var lastlen = 0;\r\n    var offsets = [0, 0, 0, 0, 0, 0];\r\n    var len = rangeKeys.length;\r\n    findNextLen(0, keys, offsets);\r\n    findNextLen(1, keys, offsets);\r\n    findNextLen(2, keys, offsets);\r\n\r\n    rangeKeys.forEach(function (rangeKey) {\r\n        if (rangeKey.length !== lastlen) {\r\n            for (i = lastlen + 1; i <= rangeKey.length; ++i) {\r\n                findNextLen(i + 2, keys, offsets);\r\n            }\r\n            //   console.log(` shifted to ${rangeKey.length} with offsets beeing ${offsets.join(' ')}`);\r\n            //   console.log(` here 0 ${offsets[0]} : ${keys[Math.min(keys.length-1, offsets[0])].length}  ${keys[Math.min(keys.length-1, offsets[0])]} `);\r\n            //  console.log(` here 5-1  ${keys[offsets[5]-1].length}  ${keys[offsets[5]-1]} `);\r\n            //   console.log(` here 5 ${offsets[5]} : ${keys[Math.min(keys.length-1, offsets[5])].length}  ${keys[Math.min(keys.length-1, offsets[5])]} `);\r\n            lastlen = rangeKey.length;\r\n        }\r\n        for (var i = offsets[0]; i < offsets[5]; ++i) {\r\n            var d = Distance.calcDistanceAdjusted(rangeKey, keys[i]);\r\n            // console.log(`${rangeKey.length-keys[i].length} ${d} ${rangeKey} and ${keys[i]}  `);\r\n            if ((d !== 1.0) && (d >= Algol.Cutoff_rangeCloseMatch)) {\r\n                //console.log(`would add ${rangeKey} for ${keys[i]} ${d}`);\r\n                var cnt = rules.length;\r\n                // we only have to add if there is not yet a match rule here which points to the same\r\n                addRangeRulesUnlessPresent(rules, keys[i], rangeKeysMap[rangeKey], keysMap[keys[i]], seenRules);\r\n                if (rules.length > cnt) {\r\n                    //console.log(` added ${(rules.length - cnt)} records at${rangeKey} for ${keys[i]} ${d}`);\r\n                }\r\n\r\n            }\r\n        }\r\n    });\r\n    /*\r\n    [\r\n        ['aEFG','aEFGH'],\r\n        ['aEFGH','aEFGHI'],\r\n        ['Odata','ODatas'],\r\n   ['Odata','Odatas'],\r\n   ['Odata','Odatb'],\r\n   ['Odata','UData'],\r\n   ['service','services'],\r\n   ['this isfunny and more','this isfunny and mores'],\r\n    ].forEach(rec => {\r\n        console.log(`distance ${rec[0]} ${rec[1]} : ${Distance.calcDistance(rec[0],rec[1])}  adf ${Distance.calcDistanceAdjusted(rec[0],rec[1])} `);\r\n\r\n    });\r\n    console.log(\"distance Odata Udata\"+ Distance.calcDistance('OData','UData'));\r\n    console.log(\"distance Odata Odatb\"+ Distance.calcDistance('OData','ODatb'));\r\n    console.log(\"distance Odatas Odata\"+ Distance.calcDistance('OData','ODataa'));\r\n    console.log(\"distance Odatas abcde\"+ Distance.calcDistance('abcde','abcdef'));\r\n    console.log(\"distance services \"+ Distance.calcDistance('services','service'));\r\n    */\r\n}\r\nvar n = 0;\r\n\r\nexport function loadModels(modelPath?: string): IMatch.IModels {\r\n    var oModel: IMatch.IModels;\r\n    oModel = {\r\n        full: { domain: {} },\r\n        rawModels: {},\r\n        domains: [],\r\n        tools: [],\r\n        rules: undefined,\r\n        category: [],\r\n        operators: {},\r\n        mRules: [],\r\n        seenRules: {},\r\n        records: [],\r\n        meta: { t3: {} }\r\n    }\r\n    var t = Date.now();\r\n    modelPath = modelPath || envModelPath;\r\n\r\n    try {\r\n        var a = CircularSer.load('./' + modelPath + '/_cachefalse.js');\r\n        //console.log(\"found a cache ?  \" + !!a);\r\n        //a = undefined;\r\n        if (a) {\r\n            debuglog(\" return preparese model \");\r\n            if (process.env.ABOT_EMAIL_USER) {\r\n                console.log(\"loaded models from cache in \" + (Date.now() - t) + \" \");\r\n            }\r\n            return a;\r\n        }\r\n    } catch (e) {\r\n        //console.log('error' + e);\r\n        // no cache file,\r\n    }\r\n    var mdls = readFileAsJSON('./' + modelPath + '/models.json');\r\n    mdls.forEach(function (sModelName) {\r\n        loadModel(modelPath, sModelName, oModel)\r\n    });\r\n\r\n    // add the categories to the model:\r\n    /*\r\n    oModel.category.forEach(function (category) {\r\n        insertRuleIfNotPresent(oModel.mRules, {\r\n            category: \"category\",\r\n            matchedString: category,\r\n            type: IMatch.EnumRuleType.WORD,\r\n            word: category,\r\n            lowercaseword: category.toLowerCase(),\r\n            bitindex : oMdl.\r\n            _ranking: 0.95\r\n        }, oModel.seenRules);\r\n    });\r\n    */\r\n\r\n    var metaBitIndex = getDomainBitIndex('meta', oModel);\r\n\r\n    // add the domain meta rule\r\n    insertRuleIfNotPresent(oModel.mRules, {\r\n        category: \"meta\",\r\n        matchedString: \"domain\",\r\n        type: IMatch.EnumRuleType.WORD,\r\n        word: \"domain\",\r\n        bitindex: metaBitIndex,\r\n        _ranking: 0.95\r\n    }, oModel.seenRules);\r\n\r\n\r\n    var fillerBitIndex = getDomainBitIndex('meta', oModel);\r\n    //add a filler rule\r\n    var fillers =  readFileAsJSON('./' + modelPath + '/filler.json');\r\n    var re = \"^((\" + fillers.join(\")|(\") + \"))$\";\r\n    oModel.mRules.push({\r\n        category: \"filler\",\r\n        type: IMatch.EnumRuleType.REGEXP,\r\n        regexp: new RegExp(re, \"i\"),\r\n        matchedString: \"filler\",\r\n        bitindex: fillerBitIndex,\r\n        _ranking: 0.9\r\n    });\r\n\r\n    //add operators\r\n    var operators = readFileAsJSON('./resources/model/operators.json');\r\n    var operatorBitIndex = getDomainBitIndex('operators', oModel);\r\n    Object.keys(operators.operators).forEach(function (operator) {\r\n        if (IMatch.aOperatorNames.indexOf(operator) < 0) {\r\n            debuglog(\"unknown operator \" + operator);\r\n            throw new Error(\"unknown operator \" + operator);\r\n        }\r\n        oModel.operators[operator] = operators.operators[operator];\r\n        oModel.operators[operator].operator = <IMatch.OperatorName>operator;\r\n        Object.freeze(oModel.operators[operator]);\r\n        var word = operator;\r\n        insertRuleIfNotPresent(oModel.mRules, {\r\n            category: \"operator\",\r\n            word: word.toLowerCase(),\r\n            lowercaseword: word.toLowerCase(),\r\n            type: IMatch.EnumRuleType.WORD,\r\n            matchedString: word,\r\n            bitindex: operatorBitIndex,\r\n            _ranking: 0.9\r\n        }, oModel.seenRules);\r\n        // add all synonyms\r\n        if (operators.synonyms[operator]) {\r\n            Object.keys(operators.synonyms[operator]).forEach(function (synonym) {\r\n                insertRuleIfNotPresent(oModel.mRules, {\r\n                    category: \"operator\",\r\n                    word: synonym.toLowerCase(),\r\n                    lowercaseword: synonym.toLowerCase(),\r\n                    type: IMatch.EnumRuleType.WORD,\r\n                    matchedString: operator,\r\n                    bitindex: operatorBitIndex,\r\n                    _ranking: 0.9\r\n                }, oModel.seenRules);\r\n            });\r\n        }\r\n    });\r\n    /*\r\n        })\r\n            {\r\n          category: \"filler\",\r\n          type: 1,\r\n          regexp: /^((start)|(show)|(from)|(in))$/i,\r\n          matchedString: \"filler\",\r\n          _ranking: 0.9\r\n        },\r\n    */\r\n    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);\r\n    addCloseExactRangeRules(oModel.mRules, oModel.seenRules);\r\n    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);\r\n    forceGC();\r\n    oModel.rules = splitRules(oModel.mRules);\r\n    forceGC();\r\n    oModel.tools = oModel.tools.sort(cmpTools);\r\n    delete oModel.seenRules;\r\n    debuglog('saving');\r\n    forceGC();\r\n    CircularSer.save('./' + modelPath + '/_cachefalse.js', oModel);\r\n    forceGC();\r\n    if (process.env.ABOT_EMAIL_USER) {\r\n        console.log(\"loaded models by calculation in \" + (Date.now() - t) + \" \");\r\n    }\r\n    return oModel;\r\n}\r\n\r\nexport function sortCategoriesByImportance(map: { [key: string]: IMatch.ICategoryDesc }, cats: string[]): string[] {\r\n    var res = cats.slice(0);\r\n    res.sort(rankCategoryByImportance.bind(undefined, map));\r\n    return res;\r\n}\r\n\r\nexport function rankCategoryByImportance(map: { [key: string]: IMatch.ICategoryDesc }, cata: string, catb: string): number {\r\n    var catADesc = map[cata];\r\n    var catBDesc = map[catb];\r\n    if (cata === catb) {\r\n        return 0;\r\n    }\r\n    // if a is before b, return -1\r\n    if (catADesc && !catBDesc) {\r\n        return -1;\r\n    }\r\n    if (!catADesc && catBDesc) {\r\n        return +1;\r\n    }\r\n\r\n    var prioA = (catADesc && catADesc.importance) || 99;\r\n    var prioB = (catBDesc && catBDesc.importance) || 99;\r\n    // lower prio goes to front\r\n    var r = prioA - prioB;\r\n    if (r) {\r\n        return r;\r\n    }\r\n    return cata.localeCompare(catb);\r\n}\r\n\r\nconst MetaF = Meta.getMetaFactory();\r\n\r\nexport function getOperator(mdl: IMatch.IModels, operator: string): IMatch.IOperator {\r\n    return mdl.operators[operator];\r\n}\r\n\r\nexport function getResultAsArray(mdl: IMatch.IModels, a: Meta.IMeta, rel: Meta.IMeta): Meta.IMeta[] {\r\n    if (rel.toType() !== 'relation') {\r\n        throw new Error(\"expect relation as 2nd arg\");\r\n    }\r\n\r\n    var res = mdl.meta.t3[a.toFullString()] &&\r\n        mdl.meta.t3[a.toFullString()][rel.toFullString()];\r\n    if (!res) {\r\n        return [];\r\n    }\r\n    return Object.getOwnPropertyNames(res).sort().map(MetaF.parseIMeta);\r\n}\r\n\r\nexport function getCategoriesForDomain(theModel: IMatch.IModels, domain: string): string[] {\r\n    if (theModel.domains.indexOf(domain) < 0) {\r\n        throw new Error(\"Domain \\\"\" + domain + \"\\\" not part of model\");\r\n    }\r\n    var res = getResultAsArray(theModel, MetaF.Domain(domain), MetaF.Relation(Meta.RELATION_hasCategory));\r\n    return Meta.getStringArray(res);\r\n}\r\n\r\nexport function getTableColumns(theModel: IMatch.IModels, domain: string): string[] {\r\n    if (theModel.domains.indexOf(domain) < 0) {\r\n        throw new Error(\"Domain \\\"\" + domain + \"\\\" not part of model\");\r\n    }\r\n    return theModel.rawModels[domain].columns.slice(0);\r\n}\r\n\r\nfunction forceGC() {\r\n    if(global && global.gc) {\r\n        global.gc();\r\n    }\r\n}\r\n\r\n/**\r\n * Return all categories of a domain which can appear on a word,\r\n * these are typically the wordindex domains + entries generated by generic rules\r\n *\r\n * The current implementation is a simplification\r\n */\r\nexport function getPotentialWordCategoriesForDomain(theModel: IMatch.IModels, domain: string): string[] {\r\n    // this is a simplified version\r\n    return getCategoriesForDomain(theModel, domain);\r\n}\r\n\r\nexport function getDomainsForCategory(theModel: IMatch.IModels, category: string): string[] {\r\n    if (theModel.category.indexOf(category) < 0) {\r\n        throw new Error(\"Category \\\"\" + category + \"\\\" not part of model\");\r\n    }\r\n    var res = getResultAsArray(theModel, MetaF.Category(category), MetaF.Relation(Meta.RELATION_isCategoryOf));\r\n    return Meta.getStringArray(res);\r\n}\r\n\r\n/*\r\nexport function getAllRecordCategoriesForTargetCategory(model: IMatch.IModels, category: string, wordsonly: boolean): { [key: string]: boolean } {\r\n    var res = {};\r\n    //\r\n    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;\r\n    var domains = getDomainsForCategory(model, category);\r\n    domains.forEach(function (domain) {\r\n        fn(model, domain).forEach(function (wordcat) {\r\n            res[wordcat] = true;\r\n        });\r\n    });\r\n    Object.freeze(res);\r\n    return res;\r\n}\r\n\r\nexport function getAllRecordCategoriesForTargetCategories(model: IMatch.IModels, categories: string[], wordsonly: boolean): { [key: string]: boolean } {\r\n    var res = {};\r\n    //\r\n    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;\r\n    var domains = undefined;\r\n    categories.forEach(function (category) {\r\n        var catdomains = getDomainsForCategory(model, category)\r\n        if (!domains) {\r\n            domains = catdomains;\r\n        } else {\r\n            domains = _.intersection(domains, catdomains);\r\n        }\r\n    });\r\n    if (domains.length === 0) {\r\n        throw new Error('categories ' + Utils.listToQuotedCommaAnd(categories) + ' have no common domain.')\r\n    }\r\n    domains.forEach(function (domain) {\r\n        fn(model, domain).forEach(function (wordcat) {\r\n            res[wordcat] = true;\r\n        });\r\n    });\r\n    Object.freeze(res);\r\n    return res;\r\n}\r\n*/\r\n\r\n/**\r\n * givena  set  of categories, return a structure\r\n *\r\n *\r\n * { domains : [\"DOMAIN1\", \"DOMAIN2\"],\r\n *   categorySet : {   cat1 : true, cat2 : true, ...}\r\n * }\r\n */\r\nexport function getDomainCategoryFilterForTargetCategories(model: IMatch.IModels, categories: string[], wordsonly: boolean): IMatch.IDomainCategoryFilter  {\r\n    var res = {};\r\n    //\r\n    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;\r\n    var domains = undefined as string[];\r\n    categories.forEach(function (category) {\r\n        var catdomains = getDomainsForCategory(model, category)\r\n        if (!domains) {\r\n            domains = catdomains;\r\n        } else {\r\n            domains = _.intersection(domains, catdomains);\r\n        }\r\n    });\r\n    if (domains.length === 0) {\r\n        throw new Error('categories ' + Utils.listToQuotedCommaAnd(categories) + ' have no common domain.')\r\n    }\r\n    domains.forEach(function (domain) {\r\n        fn(model, domain).forEach(function (wordcat) {\r\n            res[wordcat] = true;\r\n        });\r\n    });\r\n    Object.freeze(res);\r\n    return { domains: domains,\r\n             categorySet : res};\r\n}\r\n\r\n\r\nexport function getDomainCategoryFilterForTargetCategory(model: IMatch.IModels, category: string, wordsonly: boolean): IMatch.IDomainCategoryFilter  {\r\n    return getDomainCategoryFilterForTargetCategories(model, [category],wordsonly);\r\n}\r\n\r\n\r\n"],"sourceRoot":"ABC"}